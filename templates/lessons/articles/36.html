{% extends 'lessons/temporary1.html' %}

{% block article %}
<section class="lesson-material__content"><article class="material"><h2>Рекурсия</h2>
<div style="margin-bottom: 60px;">&nbsp;</div>
<h4 style="padding-left: 60px;"><strong>План урока</strong></h4>
<div>&nbsp;</div>
<div style="padding-left: 60px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; display: table-cell; vertical-align: top; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 1px solid #4d4d4d; vertical-align: middle; border-radius: 50%; color: #4d4d4d !important; width: 40px; height: 40px; text-align: center; font-size: 18px; line-height: 40px; overflow: hidden; white-space: nowrap;">1</div>
</div>
<div style="box-sizing: content-box; margin: 0px; padding: 0px 0px 0px 25px; border: 0px; display: table-cell; vertical-align: middle; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-size: 20px; color: #4d4d4d;"><span style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-weight: 500;"><a style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; color: #4d4d4d !important;" href="#1">Задачи на сочетания</a></span></div>
</div>
</div>
<div>&nbsp;</div>
<div style="padding-left: 60px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; display: table-cell; vertical-align: top; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 1px solid #4d4d4d; vertical-align: middle; border-radius: 50%; color: #4d4d4d !important; width: 40px; height: 40px; text-align: center; font-size: 18px; line-height: 40px; overflow: hidden; white-space: nowrap;">2</div>
</div>
<div style="box-sizing: content-box; margin: 0px; padding: 0px 0px 0px 25px; border: 0px; display: table-cell; vertical-align: middle; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-size: 20px; color: #4d4d4d;"><span style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-weight: 500;"><a style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; color: #4d4d4d !important;" href="#2">Определение рекурсии, принцип работы</a></span></div>
</div>
</div>
<div>&nbsp;</div>
<div style="padding-left: 60px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; display: table-cell; vertical-align: top; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 1px solid #4d4d4d; vertical-align: middle; border-radius: 50%; color: #4d4d4d !important; width: 40px; height: 40px; text-align: center; font-size: 18px; line-height: 40px; overflow: hidden; white-space: nowrap;">3</div>
</div>
<div style="box-sizing: content-box; margin: 0px; padding: 0px 0px 0px 25px; border: 0px; display: table-cell; vertical-align: middle; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-size: 20px; color: #4d4d4d;"><span style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-weight: 500;"><a style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; color: #4d4d4d !important;" href="#3">Рекурсивные определения. Рекурсия как обобщение цикла</a></span></div>
</div>
</div>
<div>&nbsp;</div>
<div style="padding-left: 60px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; display: table-cell; vertical-align: top; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 1px solid #4d4d4d; vertical-align: middle; border-radius: 50%; color: #4d4d4d !important; width: 40px; height: 40px; text-align: center; font-size: 18px; line-height: 40px; overflow: hidden; white-space: nowrap;">4</div>
</div>
<div style="box-sizing: content-box; margin: 0px; padding: 0px 0px 0px 25px; border: 0px; display: table-cell; vertical-align: middle; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-size: 20px; color: #4d4d4d;"><span style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-weight: 500;"><a style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; color: #4d4d4d !important;" href="#4">Опасности использования рекурсивных алгоритмов </a></span></div>
</div>
</div>
<div>&nbsp;</div>
<div style="padding-left: 60px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; display: table-cell; vertical-align: top; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 1px solid #4d4d4d; vertical-align: middle; border-radius: 50%; color: #4d4d4d !important; width: 40px; height: 40px; text-align: center; font-size: 18px; line-height: 40px; overflow: hidden; white-space: nowrap;">5</div>
</div>
<div style="box-sizing: content-box; margin: 0px; padding: 0px 0px 0px 25px; border: 0px; display: table-cell; vertical-align: middle; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-size: 20px; color: #4d4d4d;"><span style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-weight: 500;"><a style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; color: #4d4d4d !important;" href="#5">Красота требует жертв?</a></span></div>
</div>
</div>
<div>&nbsp;</div>
<div style="padding-left: 60px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; display: table-cell; vertical-align: top; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 1px solid #4d4d4d; vertical-align: middle; border-radius: 50%; color: #4d4d4d !important; width: 40px; height: 40px; text-align: center; font-size: 18px; line-height: 40px; overflow: hidden; white-space: nowrap;">6</div>
</div>
<div style="box-sizing: content-box; margin: 0px; padding: 0px 0px 0px 25px; border: 0px; display: table-cell; vertical-align: middle; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-size: 20px; color: #4d4d4d;"><span style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-weight: 500;"><a style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; color: #4d4d4d !important;" href="#6">Несколько рекурсивных веток. Деревья</a></span></div>
</div>
</div>
<div>&nbsp;</div>
<div style="padding-left: 60px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; display: table-cell; vertical-align: top; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 1px solid #4d4d4d; vertical-align: middle; border-radius: 50%; color: #4d4d4d !important; width: 40px; height: 40px; text-align: center; font-size: 18px; line-height: 40px; overflow: hidden; white-space: nowrap;">7</div>
</div>
<div style="box-sizing: content-box; margin: 0px; padding: 0px 0px 0px 25px; border: 0px; display: table-cell; vertical-align: middle; height: 40px;">
<div style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-size: 20px; color: #4d4d4d;"><span style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; font-weight: 500;"><a style="box-sizing: content-box; margin: 0px; padding: 0px; border: 0px; color: #4d4d4d !important;" href="#7">Бонус. Решаем Судоку</a></span></div>
</div>
</div>
<div style="margin-bottom: 60px;">&nbsp;</div>
<div style="background-color: #f5f2f0; padding: 60px;">
<h4><strong>Аннотация</strong></h4>
<div><em>На&nbsp;данном занятии мы&nbsp;познакомимся с&nbsp;понятием рекурсии, покажем ее&nbsp;связь с&nbsp;уже знакомыми нам конструкциями (циклы и&nbsp;функции). Также разберем наиболее часто встречаемые ошибки и&nbsp;«классические» примеры.</em></div>
</div>
<p><a name="1"></a></p>
<div style="margin-bottom: 60px;">&nbsp;</div>
<h4>1. Задача на сочетания</h4>
<p>&nbsp;</p>
<div style="padding-left: 60px;">
<p>Задача на&nbsp;сочетания&nbsp;— это простейшая комбинаторная задача на&nbsp;сочетания без повторений: сколькими способами можно из&nbsp;данных n&nbsp;предметов выбрать некоторые k&nbsp;предметов, если порядок их&nbsp;выбора не&nbsp;важен?</p>
<p>Ответом на&nbsp;эту задачу является величина</p>
<p><img src="https://yastatic.net/s3/lyceum/content/image/recursion-3.jpg" width="250" height="auto">,</p>
<p>называемая числом сочетаний из&nbsp;n&nbsp;элементов по&nbsp;k. Запись&nbsp;n! обозначает произведение 1 · 2 · 3 · ... · n, называемое факториалом числа&nbsp;n (мы&nbsp;уже неоднократно сталкивались с&nbsp;данным понятием), при этом считается, что 0! = 1.</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #808080; font-style: italic;"># Задача на сочетания<br></span><br>
<span style="color: #ff7700; font-weight: bold;">def</span> f<span style="color: black;">(</span>n<span style="color: black;">)</span>:
    res <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
    <span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> n + <span style="color: #ff4500;">1</span><span style="color: black;">)</span>:
        res *<span style="color: #66cc66;">=</span> i
    <span style="color: #ff7700; font-weight: bold;">return</span> res
&nbsp;
&nbsp;
<span style="color: #dc143c;">time</span><span style="color: #66cc66;">=</span><span style="color: black;">(</span>f<span style="color: black;">(</span><span style="color: #ff4500;">10</span><span style="color: black;">) </span>/ <span style="color: black;">(</span>f<span style="color: black;">(</span><span style="color: #ff4500;">3</span><span style="color: black;">) </span>* f<span style="color: black;">(</span><span style="color: #ff4500;">10 </span>- <span style="color: #ff4500;">3</span><span style="color: black;">)</span><span style="color: black;">)</span><span style="color: black;">) </span>* <span style="color: #ff4500;">2</span>
<span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #dc143c;">time</span><span style="color: black;">)</span></pre>
</div>
</div>
<p><a name="2"></a></p>
<div style="margin-bottom: 60px;">&nbsp;</div>
<h4>2. Определение рекурсии, принцип работы</h4>
<p>&nbsp;</p>
<div style="padding-left: 60px;">
<p>Однако эту задачу можно решить и&nbsp;по-другому. В&nbsp;математике очень часто для упрощения вычислений, исходную задачу сводят к&nbsp;более простым.</p>
</div>
<p>&nbsp;</p>
<div style="background-color: #ffeba0; padding: 60px;">
<h4><strong>Рекурсия</strong></h4>
<div>В&nbsp;итоге можно прийти к&nbsp;тому, что будет вызвана первоначальная задача, но&nbsp;в&nbsp;несколько упрощенной форме. Такой прием называется рекурсией от&nbsp;лат. recurcio&nbsp;— возвращение. Итак, в&nbsp;программировании рекурсия&nbsp;— это подпрограмма, обращающаяся сама к&nbsp;себе (непосредственно или через цепочку подпрограмм).</div>
</div>
<p>&nbsp;</p>
<div style="padding-left: 60px;">
<p>Вернёмся к&nbsp;нашей задаче и&nbsp;рассмотрим функцию вычисления факториала с&nbsp;несколько другой стороны, постараемся применить рекурсию. Известно, что 0! = 1, 1! = 1. А&nbsp;как вычислить величину&nbsp;n! для большого&nbsp;n? Если&nbsp;бы мы&nbsp;могли вычислить величину (n-1)!, то&nbsp;тогда мы&nbsp;легко вычислим&nbsp;n!, поскольку&nbsp;n! = n · (n-1)!. Но&nbsp;как вычислить (n-1)!? Если&nbsp;бы мы&nbsp;вычислили (n-2)!, то&nbsp;мы&nbsp;сможем вычислить&nbsp;и (n-1)! = (n-1) · (n-2)!. А&nbsp;как вычислить (n-2)!? Если&nbsp;бы... В&nbsp;конце концов, мы&nbsp;дойдем до&nbsp;величины&nbsp;0!, которая равна 1. Таким образом, для вычисления факториала мы&nbsp;можем использовать значение факториала для меньшего числа.</p>
<p>Давайте напишем соответствующую функцию:</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #808080; font-style: italic;"># Вычисление факториала<br><br></span>
<span style="color: #ff7700; font-weight: bold;">def</span> factorial<span style="color: black;">(</span>n<span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">if</span> n <span style="color: #66cc66;">==</span> <span style="color: #ff4500;">0</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> <span style="color: #ff4500;">1</span>
    <span style="color: #ff7700; font-weight: bold;">else</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> n * factorial<span style="color: black;">(</span>n - <span style="color: #ff4500;">1</span><span style="color: black;">)</span></pre>
</div>
</div>
<div style="padding-left: 60px;">
<p>Логическая сложность рекурсивных функций заключается в&nbsp;изменении параметров и&nbsp;особенностях получения промежуточных результатов при последовательном обращении подпрограммы к&nbsp;себе. Выполняется две серии шагов. Первая серия&nbsp;— это шаги рекурсивного погружения подпрограмм в&nbsp;себя до&nbsp;тех пор, пока выбранный параметр не&nbsp;достигнет граничного значения (глубина рекурсии). Вторая серия&nbsp;— это шаги рекурсивного выхода до&nbsp;тех пор, пока значение выбранного параметра не&nbsp;достигнет начального. Она, как правило, и&nbsp;обеспечивает получение промежуточных и&nbsp;конечных результатов. Отличной иллюстрацией сказанного служит программа:</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #808080; font-style: italic;"># Принцип работы рекурсивной функции<br><br></span>
<span style="color: #ff7700; font-weight: bold;">def</span> depth<span style="color: black;">(</span>n<span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'Погружение '</span><span style="color: #66cc66;">,</span> n<span style="color: black;">)</span><span style="color: #66cc66;">;</span>
    <span style="color: #ff7700; font-weight: bold;">if</span> <span style="color: black;">(</span>n <span style="color: #66cc66;">&gt; </span><span style="color: #ff4500;">1</span><span style="color: black;">)</span>:
      depth<span style="color: black;">(</span>n - <span style="color: #ff4500;">1</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">else</span>:
      <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'________________'</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'Выход'</span><span style="color: #66cc66;">,</span> n<span style="color: black;">)</span>
&nbsp;<br>
depth<span style="color: black;">(</span><span style="color: #ff4500;">6</span><span style="color: black;">)</span></pre>
</div>
</div>
<div style="padding-left: 60px;">
<p><br>На&nbsp;практике необходимо убеждаться, чтобы глубина рекурсий была мала.</p>
<p>В&nbsp;общем случае рекурсия тяготеет к&nbsp;<span style="text-decoration: underline;"><a href="https://ru.wikipedia.org/wiki/Декларативное_программирование" target="_blank" rel="noopener">декларативному</a></span> стилю программирования. Если в&nbsp;двух словах, то&nbsp;когда мы&nbsp;пишем императивную функцию (как делали всё время до&nbsp;этого), то&nbsp;отвечаем на&nbsp;вопрос «Как достигнуть необходимого результата?», а&nbsp;когда создаём декларативную&nbsp;— на&nbsp;вопрос «Что такое наш результат?».</p>
</div>
<p><a name="3"></a></p>
<div style="margin-bottom: 60px;">&nbsp;</div>
<h4>3. Рекурсивные определения. Рекурсия как обобщение цикла</h4>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div style="background-color: #ffeba0; padding: 60px;">
<h4><strong>Рекурсивное определение</strong></h4>
<div>Рекурсивное определение&nbsp;— часто применяемый в&nbsp;математике способ задания функций, при котором значение искомой функции в&nbsp;данной точке определяется через ее&nbsp;значения в&nbsp;предшествующих точках.</div>
</div>
<p>&nbsp;</p>
<div style="padding-left: 60px;">
<p>Мощность рекурсивного определения заключается, очевидно, в&nbsp;том, что оно позволяет с&nbsp;помощью конечного высказывания определить бесконечное множество объектов. Например, функцию степени числа с&nbsp;целым неотрицательным показателем, можно представить так:</p>
<p><img src="https://yastatic.net/s3/lyceum/content/image/recursion-2.jpg" width="250" height="auto"></p>
<p>Если известно, что нечто можно описать рекурсивно, то&nbsp;это можно решать рекурсивно, но&nbsp;не&nbsp;значит, что это нужно делать.</p>
<p>Рекурсия также является обобщением цикла. Пример ниже демонстрирует простую замену цикла рекурсией. Однако гораздо чаще следует делать обратную замену, так как рекурсии требуют дополнительной памяти и&nbsp;замедляют работу программ.</p>
<p>Цикл:</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">def</span> <span style="color: #008000;">iter</span><span style="color: black;">(</span><span style="color: black;">)</span>:
  <span style="color: #ff7700; font-weight: bold;">global</span> i<span style="color: #66cc66;">, </span>s1
  <span style="color: #ff7700; font-weight: bold;">while</span> i <span style="color: #66cc66;">&lt; </span><span style="color: #ff4500;">5</span>:
      i +<span style="color: #66cc66;">= </span><span style="color: #ff4500;">1</span>
      s1 +<span style="color: #66cc66;">= </span>i
&nbsp;
&nbsp;
i<span style="color: #66cc66;">, </span>s1 <span style="color: #66cc66;">= </span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">, </span><span style="color: #ff4500;">0</span>
<span style="color: #008000;">iter</span><span style="color: black;">(</span><span style="color: black;">)</span>
<span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'Циклы:'</span><span style="color: #66cc66;">, </span>s1<span style="color: black;">)</span></pre>
</div>
</div>
<div style="padding-left: 60px;">
<p><br>Рекурсия:</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">def</span> rec<span style="color: black;">(</span><span style="color: black;">)</span>:
  <span style="color: #ff7700; font-weight: bold;">global</span> i<span style="color: #66cc66;">, </span>s2
  <span style="color: #ff7700; font-weight: bold;">if</span> i <span style="color: #66cc66;">&lt; </span><span style="color: #ff4500;">5</span>:
    i +<span style="color: #66cc66;">= </span><span style="color: #ff4500;">1</span>
    s2 +<span style="color: #66cc66;">= </span>i
    rec<span style="color: black;">(</span><span style="color: black;">)</span>
&nbsp;<br>
i<span style="color: #66cc66;">, </span>s2 <span style="color: #66cc66;">= </span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">, </span><span style="color: #ff4500;">0</span>
rec<span style="color: black;">(</span><span style="color: black;">)</span>
<span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'Рекурсия:'</span><span style="color: #66cc66;">,</span> s2<span style="color: black;">)</span></pre>
</div>
</div>
<p><a name="4"></a></p>
<div style="margin-bottom: 60px;">&nbsp;</div>
<h4>4. Опасности использования рекурсивных алгоритмов</h4>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div style="background-color: #ffeba0; padding: 60px;">
<h4><strong>Важно</strong></h4>
<div>Наиболее распространённой ошибкой при использовании рекурсии является бесконечная рекурсия, когда цепочка вызовов функций никогда не&nbsp;завершается и&nbsp;продолжается, пока не&nbsp;кончится свободная память в&nbsp;компьютере.</div>
</div>
<p>&nbsp;</p>
<div style="padding-left: 60px;">
<p>Определим две наиболее распространенные причины для бесконечной рекурсии на&nbsp;примере некорректно написанной функции нахождения факториала числа (рекурсивное отношение которой мы&nbsp;уже рассматривали с&nbsp;вами сегодня).</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">def</span> <span style="color: #008000;">factorial</span><span style="color: black;">(</span>n<span style="color: black;">)</span>:
     <span style="color: #ff7700; font-weight: bold;">return</span> n * <span style="color: #008000;">factorial</span><span style="color: black;">(</span>n - <span style="color: #ff4500;">1</span><span style="color: black;">)</span></pre>
</div>
</div>
<div>&nbsp;</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">def</span> <span style="color: #008000;">factorial</span><span style="color: black;">(</span>n<span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">if</span> n <span style="color: #66cc66;">==</span> <span style="color: #ff4500;">0</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> <span style="color: #ff4500;">1</span>
    <span style="color: #ff7700; font-weight: bold;">else</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> n * <span style="color: #008000;">factorial</span><span style="color: black;">(</span>n<span style="color: black;">)</span></pre>
</div>
</div>
<div style="padding-left: 60px;">
<p><br>Итак, при разработке рекурсивной функции необходимо, прежде всего, оформлять условия завершения рекурсии и&nbsp;думать, почему рекурсия когда-либо завершит работу.</p>
</div>
<p>&nbsp;</p>
<div style="background-color: #ffeba0; padding: 60px;">
<h4><strong>Важно</strong></h4>
<div>Ещё одна проблема, связанная с&nbsp;использованием рекурсивных функций,&nbsp;— это нетривиальность задачи оценки сложности и&nbsp;эффективности алгоритма. Сложность этих алгоритмов зависит не&nbsp;только от&nbsp;сложности внутренних циклов, но&nbsp;и&nbsp;от&nbsp;количества итераций рекурсии. Рекурсивная процедура может выглядеть достаточно простой, но&nbsp;она может серьёзно усложнить программу, многократно вызывая себя.</div>
</div>
<p>&nbsp;</p>
<p><a name="5"></a></p>
<div style="margin-bottom: 60px;">&nbsp;</div>
<h4>5. Красота требует жертв?</h4>
<p>&nbsp;</p>
<div style="padding-left: 60px;">
<p>Напишем программу перевода числа из&nbsp;десятичной системы счисления в&nbsp;двоичную (а&nbsp;на&nbsp;самом деле и&nbsp;в&nbsp;любую другую позиционную систему).</p>
<p>Для начала вспомним базовый алгоритм перевода:</p>
<p><strong>Шаг&nbsp;1.</strong> Разделить число на&nbsp;основание системы счисления в&nbsp;которую осуществляется перевод (в&nbsp;нашем случае два). Запишите остаток</p>
<p><strong>Шаг&nbsp;2.</strong> Если результат деления больше или равен&nbsp;2, продолжать делить его на&nbsp;2&nbsp;до&nbsp;тех пор, пока результат деления не&nbsp;станет равен 1.</p>
<p><strong>Шаг&nbsp;3.</strong> Выписать результат последнего деления и&nbsp;все остатки от&nbsp;деления в&nbsp;обратном порядке в&nbsp;одну строку.</p>
<p>Рассмотрим на&nbsp;примере перевода числа 136&nbsp;в двоичную систему счисления</p>
<p><img src="https://yastatic.net/s3/lyceum/content/image/recursion-1.jpg" width="450" height="auto"></p>
<p>136<sub>10</sub> = 10001000<sub>2</sub></p>
<p>С&nbsp;помощью рекурсии реализовать этот алгоритм можно очень красивым и&nbsp;лаконичным кодом.</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">def</span> bin<span style="color: black;">(</span>a<span style="color: black;">)</span>:
  <span style="color: #ff7700; font-weight: bold;">if</span> a <span style="color: #66cc66;">&gt; </span><span style="color: #ff4500;">1</span>:
    bin<span style="color: black;">(</span>a // <span style="color: #ff4500;">2</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span>a % <span style="color: #ff4500;">2</span><span style="color: black;">)</span>
&nbsp;</pre>
</div>
</div>
<p><a name="6"></a></p>
<div style="margin-bottom: 60px;">&nbsp;</div>
<h4>6. Несколько рекурсивных веток. Деревья</h4>
<p>&nbsp;</p>
<div style="padding-left: 60px;">
<p>Рассмотрим в&nbsp;качестве примера функцию, вычисляющую числа Фибоначчи.</p>
<p>Числа Фибоначчи&nbsp;— это ряд чисел: 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89..., в&nbsp;котором два первых элемента равны&nbsp;1, а&nbsp;каждый следующий&nbsp;— сумме двух предыдущих. Удивительно, что отношение двух соседних чисел Фибоначчи стремится к&nbsp;числу золотого сечения: 1,6180339887.</p>
<p>Составим рекурсивное определение этих чисел и&nbsp;сразу запишем его в&nbsp;виде функции:</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">def</span> fib<span style="color: black;">(</span>n<span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">if</span> n <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">1</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> <span style="color: #ff4500;">1</span>
    <span style="color: #ff7700; font-weight: bold;">else</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> fib<span style="color: black;">(</span>n - <span style="color: #ff4500;">1</span><span style="color: black;">)</span> + fib<span style="color: black;">(</span>n - <span style="color: #ff4500;">2</span><span style="color: black;">)</span></pre>
</div>
</div>
<div style="padding-left: 60px;">
<p><br>Это удивительно, но&nbsp;программа почти слово в&nbsp;слово совпадает с&nbsp;определением чисел Фибоначчи!</p>
<p>Однако в&nbsp;этом примере мы&nbsp;столкнулись с&nbsp;новым типом рекурсии, в&nbsp;котором функция порождает целых две рекурсивные ветки. Неявно во&nbsp;время выполнения программы мы&nbsp;обходим дерево в&nbsp;глубину. Проиллюстрируем это на&nbsp;примере <strong>fib(6)</strong>:</p>
<p><img src="https://yastatic.net/s3/lyceum/content/image/recursion-fib.png" width="600" height="auto"></p>
<p>Важно понимать, что экземпляры функции выполняются не&nbsp;параллельно, а&nbsp;в&nbsp;детерминированной (то&nbsp;есть определённой) последовательности: сначала левое поддерево, а&nbsp;потом всё правое поддерево из&nbsp;любой вершины. Синим показан порядок прохождения, красным&nbsp;— возвращаемые значения, зелёным&nbsp;— структура дерева.</p>
<p>Интересным является тот факт, что дерево очень быстро разрастается при росте номера числа Фибоначчи, что влечет замедление программы и&nbsp;трату памяти.</p>
<p>Кстати, следующее число Фибоначчи вычисляется ровно в&nbsp;золотое сечение раз медленнее, чем предыдущее. Таким образом, <strong>fib(500)</strong> вычислится уже после того, как исчезнет Солнечная система.</p>
<p>Следующий пример демонстрирует этот факт. Запустите его и&nbsp;убедитесь:</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">from</span> <span style="color: #dc143c;">time</span> <span style="color: #ff7700; font-weight: bold;">import</span> <span style="color: #dc143c;">time</span>
&nbsp;
<span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">20</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">30</span><span style="color: black;">)</span>:
    s <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">time</span><span style="color: black;">(</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span>i<span style="color: #66cc66;">,</span> fib<span style="color: black;">(</span>i<span style="color: black;">)</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">"%.03f"</span> % <span style="color: black;">(</span><span style="color: #dc143c;">time</span><span style="color: black;">(</span><span style="color: black;">)</span> - s<span style="color: black;">)</span><span style="color: black;">)</span></pre>
</div>
</div>
<div style="padding-left: 60px;">
<p><br>Как видим, никакого <strong>кэширования</strong> (запоминания предыдущих вычислений) не&nbsp;происходит. Кстати, такие оптимизации присутствуют в&nbsp;функциональных языках (LISP, Haskell). К&nbsp;сожалению, в&nbsp;Python по&nbsp;умолчанию такие оптимизации недоступны, но&nbsp;можно искуственно сделать что-то подобное.</p>
<p>В&nbsp;следующем примере запоминаются последние 1000 вызовов функции <strong>fib</strong>.</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">from</span> functools <span style="color: #ff7700; font-weight: bold;">import</span> lru_cache
&nbsp;
&nbsp;
<span style="color: #66cc66;">@</span>lru_cache<span style="color: black;">(</span>maxsize<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1000</span><span style="color: black;">)</span>
<span style="color: #ff7700; font-weight: bold;">def</span> fib<span style="color: black;">(</span>n<span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">if</span> n <span style="color: #66cc66;">&lt;=</span> <span style="color: #ff4500;">1</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> <span style="color: #ff4500;">1</span>
    <span style="color: #ff7700; font-weight: bold;">else</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> fib<span style="color: black;">(</span>n - <span style="color: #ff4500;">1</span><span style="color: black;">)</span> + fib<span style="color: black;">(</span>n - <span style="color: #ff4500;">2</span><span style="color: black;">)</span>
&nbsp;
&nbsp;
<span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span>fib<span style="color: black;">(</span><span style="color: #ff4500;">100</span><span style="color: black;">)</span><span style="color: black;">)</span></pre>
</div>
</div>
<div style="padding-left: 60px;">
<p><br>Сделаем главный вывод:</p>
</div>
<p>&nbsp;</p>
<div style="background-color: #ffeba0; padding: 60px;">
<h4><strong>Важно</strong></h4>
<div>Рекурсивный метод обеспечивает удобный обход списка, дерева или графа, при этом контролируя перемещения по&nbsp;элементам и&nbsp;возвращение к&nbsp;предыдущим состояниям. Этим можно пользоваться во&nbsp;многих математических и&nbsp;прикладных задачах.</div>
</div>
<p>&nbsp;</p>
<p><a name="7"></a></p>
<div style="margin-bottom: 60px;">&nbsp;</div>
<h4>7. Бонус. Решаем Судоку</h4>
<p>&nbsp;</p>
<div style="padding-left: 60px;">
<p><img src="https://yastatic.net/s3/lyceum/content/image/sudoku.png" width="500" height="auto"></p>
<p>Вы&nbsp;уже могли сталкиваться с&nbsp;этой задачей раньше. Вспомните, как мы&nbsp;её&nbsp;решали? Попробуем теперь предложить иной способ её&nbsp;решения.</p>
<p>Предположим, что нам нужно сделать программу, которая разгадывает Судоку. Пусть поле моделируется списком списков с&nbsp;целыми числами:</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;">field <span style="color: #66cc66;">=</span> <span style="color: black;">[</span>
    <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
    <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
    <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
    <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
    <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">5</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">6</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
    <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
    <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
    <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">7</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">8</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">9</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
    <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
<span style="color: black;">]</span></pre>
</div>
</div>
<div style="padding-left: 60px;">
<p><br>Сформулируем рекурсивный алгоритм решения судоку.</p>
<ul>
<li>
<p>Если на&nbsp;поле судоку нет пустых клеток, то&nbsp;оно уже решено и&nbsp;надо просто вернуть поле в&nbsp;качестве решения.</p>
</li>
<li>
<p>Если есть пустые клетки, надо вычислить какую-либо пустую клетку, для которой количество возможных вариантов минимально. Попробовать по&nbsp;очереди проверять эти варианты, и, если будет найдено решение, вернуть его.</p>
</li>
</ul>
<p>Сама функция будет не&nbsp;сильно больше данного описания:</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">from</span> <span style="color: #dc143c;">pprint</span> <span style="color: #ff7700; font-weight: bold;">import</span> <span style="color: #dc143c;">pprint</span>
<span style="color: #ff7700; font-weight: bold;">from</span> <span style="color: #dc143c;">copy</span> <span style="color: #ff7700; font-weight: bold;">import</span> deepcopy
<span style="color: #ff7700; font-weight: bold;">from</span> <span style="color: #dc143c;">random</span> <span style="color: #ff7700; font-weight: bold;">import</span> shuffle
<span style="color: #ff7700; font-weight: bold;">from</span> <span style="color: #dc143c;">time</span> <span style="color: #ff7700; font-weight: bold;">import</span> clock
<span style="color: #483d8b;">"""
Для всех клеток на основе ограничений возвращает список возможных чисел,<br>например:
(0, 0, {2, 3, 4, 5, 6, 7, 8, 9})
(0, 1, {2, 3, 5, 6, 8, 9})
(0, 2, {2, 3, 4, 5, 6, 7, 8, 9})
(0, 3, {1, 3, 4, 5, 6, 7, 8, 9})
(0, 4, {1, 3, 4, 6, 7, 9})
(0, 5, {1, 3, 4, 5, 6, 7, 8, 9})
(0, 6, {1, 2, 4, 5, 6, 7, 8, 9})
(0, 7, {1, 2, 4, 5, 7, 8})
(0, 8, {1, 2, 4, 5, 6, 7, 8, 9})
(1, 0, {4, 5, 6, 7, 8, 9})
"""</span>
&nbsp;
&nbsp;
<span style="color: #ff7700; font-weight: bold;">def</span> get_variants<span style="color: black;">(</span>sudoku<span style="color: black;">)</span>:
    variants <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span>
    <span style="color: #ff7700; font-weight: bold;">for</span> i<span style="color: #66cc66;">,</span> row <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">enumerate</span><span style="color: black;">(</span>sudoku<span style="color: black;">)</span>:
        <span style="color: #ff7700; font-weight: bold;">for</span> j<span style="color: #66cc66;">,</span> value <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">enumerate</span><span style="color: black;">(</span>row<span style="color: black;">)</span>:
            <span style="color: #ff7700; font-weight: bold;">if</span> <span style="color: #ff7700; font-weight: bold;">not</span> value:
                <span style="color: #808080; font-style: italic;"># значения в строке</span>
                row_values <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">(</span>row<span style="color: black;">)</span>
                <span style="color: #808080; font-style: italic;"># значения в столбце</span>
                column_values <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">(</span><span style="color: black;">[</span>sudoku<span style="color: black;">[</span>k<span style="color: black;">]</span><span style="color: black;">[</span>j<span style="color: black;">]</span> <span style="color: #ff7700; font-weight: bold;">for</span> k <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">9</span><span style="color: black;">)</span><span style="color: black;">]</span><span style="color: black;">)</span>
                <span style="color: #808080; font-style: italic;"># в каком квадрате 3x3 находится клетка?<br>                # Координаты этого квадрата</span>
                sq_y <span style="color: #66cc66;">=</span> i // <span style="color: #ff4500;">3</span>
                sq_x <span style="color: #66cc66;">=</span> j // <span style="color: #ff4500;">3</span>
                square3x3_values <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">(</span><span style="color: black;">[</span>
                    sudoku<span style="color: black;">[</span>m<span style="color: black;">]</span><span style="color: black;">[</span>n<span style="color: black;">]</span>
                    <span style="color: #ff7700; font-weight: bold;">for</span> m <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span>sq_y * <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> sq_y * <span style="color: #ff4500;">3</span> + <span style="color: #ff4500;">3</span><span style="color: black;">)</span>
                    <span style="color: #ff7700; font-weight: bold;">for</span> n <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span>sq_x * <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> sq_x * <span style="color: #ff4500;">3</span> + <span style="color: #ff4500;">3</span><span style="color: black;">)</span>
                <span style="color: black;">]</span><span style="color: black;">)</span>
                exists <span style="color: #66cc66;">=</span> row_values | column_values | square3x3_values
                <span style="color: #808080; font-style: italic;"># какие значения остались?</span>
                values <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">(</span><span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">)</span><span style="color: black;">)</span> - exists
                variants.<span style="color: black;">append</span><span style="color: black;">(</span><span style="color: black;">(</span>i<span style="color: #66cc66;">,</span> j<span style="color: #66cc66;">,</span> values<span style="color: black;">)</span><span style="color: black;">)</span>
&nbsp;
    <span style="color: #ff7700; font-weight: bold;">return</span> variants
&nbsp;
&nbsp;
<span style="color: #ff7700; font-weight: bold;">def</span> solve<span style="color: black;">(</span>sudoku<span style="color: black;">)</span>:
    <span style="color: #808080; font-style: italic;"># Если судоку заполнено, это ответ</span>
    <span style="color: #ff7700; font-weight: bold;">if</span> <span style="color: #008000;">all</span><span style="color: black;">(</span><span style="color: black;">[</span>k <span style="color: #ff7700; font-weight: bold;">for</span> row <span style="color: #ff7700; font-weight: bold;">in</span> sudoku <span style="color: #ff7700; font-weight: bold;">for</span> k <span style="color: #ff7700; font-weight: bold;">in</span> row<span style="color: black;">]</span><span style="color: black;">)</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> sudoku
&nbsp;
    <span style="color: #808080; font-style: italic;"># Иначе посмотрим все варианты</span>
    variants <span style="color: #66cc66;">=</span> get_variants<span style="color: black;">(</span>sudoku<span style="color: black;">)</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Выберем тот, у которого меньше всего возможностей.</span>
    x<span style="color: #66cc66;">,</span> y<span style="color: #66cc66;">,</span> values <span style="color: #66cc66;">=</span> <span style="color: #008000;">min</span><span style="color: black;">(</span>variants<span style="color: #66cc66;">,</span> key<span style="color: #66cc66;">=</span><span style="color: #ff7700; font-weight: bold;">lambda</span> x: <span style="color: #008000;">len</span><span style="color: black;">(</span>x<span style="color: black;">[</span><span style="color: #ff4500;">2</span><span style="color: black;">]</span><span style="color: black;">)</span><span style="color: black;">)</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Попробуем все по очереди</span>
    <span style="color: #ff7700; font-weight: bold;">for</span> v <span style="color: #ff7700; font-weight: bold;">in</span> values:
        <span style="color: #808080; font-style: italic;"># deepcopy создает полную копию списка с учетом всех вложенностей</span>
        new_sudoku <span style="color: #66cc66;">=</span> deepcopy<span style="color: black;">(</span>sudoku<span style="color: black;">)</span>
        new_sudoku<span style="color: black;">[</span>x<span style="color: black;">]</span><span style="color: black;">[</span>y<span style="color: black;">]</span> <span style="color: #66cc66;">=</span> v
        <span style="color: #808080; font-style: italic;"># Если оно решилось, возвратим ответ.</span>
        s <span style="color: #66cc66;">=</span> solve<span style="color: black;">(</span>new_sudoku<span style="color: black;">)</span>
        <span style="color: #ff7700; font-weight: bold;">if</span> s:
            <span style="color: #ff7700; font-weight: bold;">return</span> s
&nbsp;
&nbsp;
s <span style="color: #66cc66;">=</span> clock<span style="color: black;">(</span><span style="color: black;">)</span>
<span style="color: #dc143c;">pprint</span><span style="color: black;">(</span>
    solve<span style="color: black;">(</span><span style="color: black;">[</span>
        <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
        <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
        <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
        <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
        <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">5</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">6</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
        <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
        <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
        <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">7</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">8</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">9</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
        <span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span>
    <span style="color: black;">]</span><span style="color: black;">)</span><span style="color: black;">)</span>
<span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'Затраченное время:'</span><span style="color: #66cc66;">,</span> clock<span style="color: black;">(</span><span style="color: black;">)</span> - s<span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'сек'</span><span style="color: black;">)</span></pre>
</div>
</div>
<div style="padding-left: 60px;">
<p><br>А&nbsp;вот ещё один пример рекурсивного решения задачи. Он&nbsp;ещё короче, но&nbsp;в&nbsp;нём есть <strong>питоновские</strong> штуки.</p>
</div>
<div style="padding-left: 60px;">
<div>
<pre class="python" style="font-family: monospace;"><span style="color: #ff7700; font-weight: bold;">from</span> <span style="color: #dc143c;">random</span> <span style="color: #ff7700; font-weight: bold;">import</span> shuffle
<span style="color: #ff7700; font-weight: bold;">from</span> <span style="color: #dc143c;">copy</span> <span style="color: #ff7700; font-weight: bold;">import</span> deepcopy
<span style="color: #ff7700; font-weight: bold;">from</span> <span style="color: #dc143c;">pprint</span> <span style="color: #ff7700; font-weight: bold;">import</span> <span style="color: #dc143c;">pprint</span>
&nbsp;
&nbsp;
<span style="color: #ff7700; font-weight: bold;">def</span> make_assumptions<span style="color: black;">(</span>sudoku<span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">for</span> i<span style="color: #66cc66;">,</span> row <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">enumerate</span><span style="color: black;">(</span>sudoku<span style="color: black;">)</span>:
        <span style="color: #ff7700; font-weight: bold;">for</span> j<span style="color: #66cc66;">,</span> value <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">enumerate</span><span style="color: black;">(</span>row<span style="color: black;">)</span>:
            <span style="color: #ff7700; font-weight: bold;">if</span> <span style="color: #ff7700; font-weight: bold;">not</span> value:
                values <span style="color: #66cc66;">=</span> <span style="color: #008000;">set</span><span style="color: black;">(</span>row<span style="color: black;">)</span> \
                         | <span style="color: #008000;">set</span><span style="color: black;">(</span><span style="color: black;">[</span>sudoku<span style="color: black;">[</span>k<span style="color: black;">]</span><span style="color: black;">[</span>j<span style="color: black;">]</span> <span style="color: #ff7700; font-weight: bold;">for</span> k <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">9</span><span style="color: black;">)</span><span style="color: black;">]</span><span style="color: black;">)</span> \
                         | <span style="color: #008000;">set</span><span style="color: black;">(</span><span style="color: black;">[</span>sudoku<span style="color: black;">[</span>m<span style="color: black;">]</span><span style="color: black;">[</span>n<span style="color: black;">]</span> <br><span style="color: #ff7700; font-weight: bold;">                                for</span> m <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: black;">(</span>i // <span style="color: #ff4500;">3</span><span style="color: black;">)</span> * <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span>
                                               <span style="color: black;">(</span>i // <span style="color: #ff4500;">3</span><span style="color: black;">)</span> * <span style="color: #ff4500;">3</span> + <span style="color: #ff4500;">3</span><span style="color: black;">)</span>
                                <span style="color: #ff7700; font-weight: bold;">for</span> n <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: black;">(</span>j // <span style="color: #ff4500;">3</span><span style="color: black;">)</span> * <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span>
                                               <span style="color: black;">(</span>j // <span style="color: #ff4500;">3</span><span style="color: black;">)</span> * <span style="color: #ff4500;">3</span> + <span style="color: #ff4500;">3</span><span style="color: black;">)</span><span style="color: black;">]</span><span style="color: black;">)</span>
                <span style="color: #ff7700; font-weight: bold;">yield</span> i<span style="color: #66cc66;">,</span> j<span style="color: #66cc66;">,</span> <span style="color: #008000;">list</span><span style="color: black;">(</span><span style="color: #008000;">set</span><span style="color: black;">(</span><span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">)</span><span style="color: black;">)</span> - values<span style="color: black;">)</span>
&nbsp;
&nbsp;
<span style="color: #ff7700; font-weight: bold;">def</span> solve<span style="color: black;">(</span>sudoku<span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">if</span> <span style="color: #008000;">all</span><span style="color: black;">(</span><span style="color: black;">[</span>k <span style="color: #ff7700; font-weight: bold;">for</span> row <span style="color: #ff7700; font-weight: bold;">in</span> sudoku <span style="color: #ff7700; font-weight: bold;">for</span> k <span style="color: #ff7700; font-weight: bold;">in</span> row<span style="color: black;">]</span><span style="color: black;">)</span>:
        <span style="color: #ff7700; font-weight: bold;">return</span> sudoku
    assumptions <span style="color: #66cc66;">=</span> <span style="color: #008000;">list</span><span style="color: black;">(</span>make_assumptions<span style="color: black;">(</span>sudoku<span style="color: black;">)</span><span style="color: black;">)</span>
    shuffle<span style="color: black;">(</span>assumptions<span style="color: black;">)</span>
&nbsp;
    x<span style="color: #66cc66;">,</span> y<span style="color: #66cc66;">,</span> values <span style="color: #66cc66;">=</span> <span style="color: #008000;">min</span><span style="color: black;">(</span>assumptions<span style="color: #66cc66;">,</span> key<span style="color: #66cc66;">=</span><span style="color: #ff7700; font-weight: bold;">lambda</span> x: <span style="color: #008000;">len</span><span style="color: black;">(</span>x<span style="color: black;">[</span><span style="color: #ff4500;">2</span><span style="color: black;">]</span><span style="color: black;">)</span><span style="color: black;">)</span>
&nbsp;
    <span style="color: #ff7700; font-weight: bold;">for</span> v <span style="color: #ff7700; font-weight: bold;">in</span> values:
        new_sudoku <span style="color: #66cc66;">=</span> deepcopy<span style="color: black;">(</span>sudoku<span style="color: black;">)</span>
        new_sudoku<span style="color: black;">[</span>x<span style="color: black;">]</span><span style="color: black;">[</span>y<span style="color: black;">]</span> <span style="color: #66cc66;">=</span> v
        s <span style="color: #66cc66;">=</span> solve<span style="color: black;">(</span>new_sudoku<span style="color: black;">)</span>
        <span style="color: #ff7700; font-weight: bold;">if</span> s:
            <span style="color: #ff7700; font-weight: bold;">return</span> s
&nbsp;
&nbsp;
<span style="color: #dc143c;">pprint</span><span style="color: black;">(</span>solve<span style="color: black;">(</span>field<span style="color: black;">)</span><span style="color: black;">)</span>
&nbsp;</pre>
</div>
</div>
<div style="padding-left: 60px;">
<p><br>Два предыдущих примера демонстрируют преимущество рекурсии&nbsp;— написание коротких и&nbsp;легко читаемых программ.</p>
<p>Попробуйте сравнить эти программы с&nbsp;императивным вариантом (без использования рекурсии).</p>
<p>С&nbsp;рекурсией вы&nbsp;ещё встретитесь много раз. Помните, что она&nbsp;— <strong>не&nbsp;панацея</strong>, но&nbsp;позволяет элегантно и&nbsp;эффективно решать широкий круг задач.</p>
<p>А&nbsp;пока&nbsp;— всё, переходите к&nbsp;задачам!</p>
</div></article></section>
{%endblock%}